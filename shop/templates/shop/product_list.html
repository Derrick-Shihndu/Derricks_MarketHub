{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'shop/css/shop.css' %}">

<h1>ðŸ›’ Available Products</h1>
<h2>Shop Products</h2>
<form method="get" action="{% url 'shop:product_list' %}">
    <input type="text" name="q" placeholder="Search products..." value="{{ query }}">
    
    <select name="category">
        <option value="">All Categories</option>
        {% for category in categories %}
            <option value="{{ category.id }}" {% if category.id|stringformat:"s" == selected_category %}selected{% endif %}>
                {{ category.name }}
            </option>
        {% endfor %}
    </select>

    <button type="submit">Search</button>
</form>

<hr>

<div class="row">
  {% for product in products %}
    <div class="col-md-4 mb-4">
      <div class="card">
        <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}">
        <div class="card-body">
          <h5 class="card-title">{{ product.name }}</h5>
          <p class="card-text">{{ product.description|truncatechars:100 }}</p>
          <p><strong>Ksh {{ product.price }}</strong></p>
          <!-- FIXED: Added the namespace 'shop:' -->
          <a href="{% url 'shop:product_detail' product.id %}" class="btn btn-primary">View</a>
        </div>
      </div>
    </div>
  {% empty %}
    <p>No products available.</p>
  {% endfor %}
</div>

{% endblock %}
